apiVersion: tekton.dev/v1beta1
kind: Task
metadata:
  name: bcdk-build
  namespace: 30b186-tools
spec:
  params:
    - description: the pull-request number
      name: pull-request
      type: string
  steps:
    - image: 'image-registry.openshift-image-registry.svc:5000/30b186-tools/nodejs-oc:latest'
      name: build-pull-request
      resources: {}
      script: |
        #!/usr/bin/env bash
        cd /tmp/source
        ls -la
        git status
        cd pipeline
        pwd
        echo "$(inputs.params.pull-request)"
        which oc
        oc version
        oc project
        oc project 30b186-tools
        oc project
        which git
        git version
        which node
        node --version
        which npm
        npm --version
        npm install
        ls -la
        # DEBUG=* npm run build -- --pr=$(inputs.params.pull-request)
        DEBUG=* npm run build -- --pr=80
  workspaces:
    - name: source
      description: the folder where the project was checked out
      mountPath: /tmp/source
      readOnly: false
